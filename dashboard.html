<!DOCTYPE html>
<html lang="en" class="bg-black text-white scroll-smooth overflow-x-hidden">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard // The Lab</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@500;700;900&family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            safelist: [
                'bg-acid', 'bg-cyan', 'bg-magenta', 'text-black', 'text-white', 
                'text-acid', 'text-cyan', 'text-magenta',
                'border-acid', 'border-cyan', 'border-magenta',
                'hover:border-acid', 'hover:text-acid', 'hover:bg-acid/10',
                'hover:border-cyan', 'hover:text-cyan', 'hover:bg-cyan/10',
                'hover:border-magenta', 'hover:text-magenta', 'hover:bg-magenta/10'
            ],
            theme: {
                extend: {
                    fontFamily: { loud: ['Oswald', 'sans-serif'], mono: ['Space Mono', 'monospace'] },
                    colors: { acid: '#ccff00', cyan: '#00ffff', magenta: '#ff00ff' }
                }
            }
        }
    </script>
    <style>
        ::selection { background-color: #ccff00; color: #000; }
        .chaos-grid { background-image: radial-gradient(#333 1px, transparent 1px); background-size: 40px 40px; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #111; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #333; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #00ffff; }
        details > summary { list-style: none; }
        details > summary::-webkit-details-marker { display: none; }
        .sticky-bar { top: 80px; }
        @media (min-width: 768px) { .sticky-bar { top: 100px; } }
    </style>
</head>
<body id="top" class="font-mono antialiased chaos-grid selection:bg-acid selection:text-black min-h-screen flex flex-col">

    <!-- ================= HEADER ================= -->
    <header class="border-b-4 border-white bg-black sticky top-0 z-50 h-[80px] md:h-[100px] box-border">
        <div class="max-w-[1600px] mx-auto px-6 py-4 flex justify-between items-center h-full">
            <div class="flex items-center gap-4 md:gap-6">
                <div class="w-10 h-10 md:w-14 h-14 border-2 border-acid overflow-hidden bg-gray-800">
                    <img src="IMAGE.png" alt="Cody Keegan" class="w-full h-full object-cover grayscale hover:grayscale-0 transition-all">
                </div>
                <div>
                    <h1 class="font-loud text-xl md:text-4xl uppercase tracking-tighter leading-none">The <span class="text-acid">Dashboard</span></h1>
                    <p class="text-[10px] text-gray-500 hidden md:block uppercase tracking-widest mt-1">Operator: Cody Keegan // Access: Level_01</p>
                </div>
            </div>
            <a href="index.html" class="font-mono text-[10px] md:text-xs border-2 border-white px-3 py-1.5 hover:bg-white hover:text-black transition-all">LOGOUT_</a>
        </div>
    </header>

    <!-- ================= MAIN CONTENT ================= -->
    <main class="max-w-[1600px] mx-auto px-4 md:px-6 py-8 flex-grow w-full">
        
        <div class="mb-8 md:mb-12">
            <h2 class="font-loud text-4xl md:text-7xl uppercase leading-none mb-4">Connection <span class="text-cyan">Established</span>.</h2>
            <p class="text-base md:text-xl text-gray-400 max-w-2xl font-mono leading-tight">Everything is an experiment. Choose your tools wisely.</p>
        </div>

        <!-- ================= STICKY FILTER BAR ================= -->
        <div class="sticky sticky-bar z-40 bg-black/95 border-y-2 border-gray-800 py-4 mb-12 backdrop-blur-md">
            <div class="flex flex-col xl:flex-row gap-4 items-stretch">
                <!-- Search Input -->
                <div class="flex-grow flex items-center gap-3 bg-gray-900 border border-gray-800 px-4 py-2">
                    <span class="text-acid font-mono font-bold">></span>
                    <input type="text" id="globalSearch" placeholder="SEARCH SYSTEM..." class="bg-transparent border-none text-white font-mono text-sm md:text-base focus:outline-none w-full placeholder-gray-600">
                </div>
                
                <!-- Dropdowns -->
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 md:gap-4">
                    <select id="globalCategory" class="bg-black border border-gray-700 text-gray-300 font-mono text-[10px] md:text-xs px-3 py-2.5 focus:border-acid focus:outline-none cursor-pointer uppercase">
                        <option value="all">CATEGORY: ALL</option>
                    </select>
                    <select id="globalStack" class="bg-black border border-gray-700 text-gray-300 font-mono text-[10px] md:text-xs px-3 py-2.5 focus:border-cyan focus:outline-none cursor-pointer uppercase">
                        <option value="all">FILTER BY STACK</option>
                    </select>
                    <select id="globalSort" class="bg-black border border-gray-700 text-gray-300 font-mono text-[10px] md:text-xs px-3 py-2.5 focus:border-magenta focus:outline-none cursor-pointer uppercase">
                        <option value="az">SORT: A-Z</option>
                        <option value="za">SORT: Z-A</option>
                        <option value="status">SORT: STATUS</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- SECTION 1: TOOLS GRID -->
        <section id="tools" class="mb-24 scroll-mt-[180px]">
            <div class="flex flex-col md:flex-row md:items-center justify-between border-b-2 border-gray-800 pb-4 mb-8">
                <h2 class="font-loud text-3xl md:text-5xl uppercase tracking-tighter">01 // <span class="text-acid">Inventory</span></h2>
                <p class="text-[9px] font-mono text-gray-500 uppercase tracking-widest mt-2 md:mt-0">Affiliate Links Active. No extra cost to user.</p>
            </div>

            <!-- Grid Container: Clean Responsive Grid -->
            <div id="tools-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <p class="col-span-full text-gray-500 font-mono animate-pulse">> ACCESSING DATABASE...</p>
            </div>
        </section>

        <!-- SECTION 2: CHALLENGE STACKS -->
        <section id="stacks" class="mb-24 scroll-mt-[180px]">
            <div class="flex flex-col sm:flex-row sm:items-center justify-between border-b-2 border-gray-800 pb-4 mb-8 gap-4">
                <h2 class="font-loud text-3xl md:text-5xl uppercase tracking-tighter">02 // <span class="text-cyan">Stacks</span></h2>
                <button id="toggleStacksBtn" data-state="collapsed" onclick="toggleAllStacks()" class="text-[9px] font-mono text-cyan uppercase tracking-widest border border-cyan/30 bg-cyan/10 px-4 py-2 hover:bg-cyan/20 transition-colors">
                    > EXPAND ALL
                </button>
            </div>

            <div id="challenge-stacks-container" class="space-y-4">
                <p class="text-gray-500 font-mono animate-pulse">> LOADING BLUEPRINTS...</p>
            </div>
        </section>

    </main>

    <!-- ================= FOOTER ================= -->
    <footer class="border-t-2 border-gray-900 bg-black py-10 px-6 text-center mt-auto">
        <p class="text-gray-600 text-[10px] uppercase tracking-[0.3em] mb-4">CodyKeegan.AI // Build the weird things.</p>
        <div class="flex flex-wrap justify-center gap-6 font-mono text-[10px] text-gray-500 uppercase tracking-widest">
            <a href="about.html" class="hover:text-white transition-colors">About</a>
            <a href="affiliate.html" class="hover:text-acid transition-colors">Affiliate</a>
            <a href="terms.html" class="hover:text-cyan transition-colors">Terms</a>
            <a href="privacy.html" class="hover:text-magenta transition-colors">Privacy</a>
            <a href="contact.html" class="hover:text-white transition-colors">Contact</a>
        </div>
    </footer>

    <!-- ================= JAVASCRIPT ================= -->
    <script>
        let globalTools = [];
        let globalStacks = [];

        const toolCategoryMap = {
            "Zapier": "Automation", "Make": "Automation", "Instantly": "Automation",
            "OpenAI": "Agents", "Anthropic": "Agents", "Claude": "Agents", "Vapi": "Agents", "Retell AI": "Agents", "Bland AI": "Agents",
            "ElevenLabs": "Media", "HeyGen": "Media", "Midjourney": "Media",
            "Perplexity": "Research",
            "Cloudflare Pages": "Infra", "Stripe": "Infra", "Kit": "Infra", "Twilio": "Infra",
            "Webflow": "Design", "Framer": "Design", "Bubble": "Design",
            "Notion": "Data", "Airtable": "Data", "Phantombuster": "Data", "Apify": "Data",
            "GitHub": "Dev"
        };

        function getCategoryIcon(category) {
            const icons = {
                'Automation': '<svg class="w-full h-full" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83"/></svg>',
                'Agents': '<svg class="w-full h-full" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="10" rx="2"/><circle cx="12" cy="5" r="2"/><path d="M12 7v4M8 15h.01M16 15h.01"/></svg>',
                'Media': '<svg class="w-full h-full" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"/><line x1="7" y1="2" x2="7" y2="22"/><line x1="17" y1="2" x2="17" y2="22"/><line x1="2" y1="12" x2="22" y2="12"/><line x1="2" y1="7" x2="7" y2="7"/><line x1="2" y1="17" x2="7" y2="17"/><line x1="17" y1="17" x2="22" y2="17"/><line x1="17" y1="7" x2="22" y2="7"/></svg>',
                'Research': '<svg class="w-full h-full" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>',
                'Infra': '<svg class="w-full h-full" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="2" width="20" height="8" rx="2"/><rect x="2" y="14" width="20" height="8" rx="2"/><line x1="6" y1="6" x2="6" y2="6"/><line x1="6" y1="18" x2="6" y2="18"/></svg>',
                'Data': '<svg class="w-full h-full" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>'
            };
            return icons[category] || '<svg class="w-full h-full" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>';
        }

        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const [toolsRes, stacksRes] = await Promise.all([
                    fetch('tools.json').catch(() => ({ ok: false })),
                    fetch('challenge-stacks.json').catch(() => ({ ok: false }))
                ]);
                
                if (toolsRes.ok) globalTools = await toolsRes.json();
                if (stacksRes.ok) globalStacks = await stacksRes.json();
                
                globalTools.forEach(t => {
                    t.category = toolCategoryMap[t.name] || "Dev";
                    t.usedIn = t.usedIn || [];
                });

                populateDropdowns();
                renderAll();

                document.getElementById('globalSearch').addEventListener('input', renderAll);
                document.getElementById('globalCategory').addEventListener('change', renderAll);
                document.getElementById('globalStack').addEventListener('change', renderAll);
                document.getElementById('globalSort').addEventListener('change', renderAll);

            } catch (e) {
                console.error("Initialization Error:", e);
                document.getElementById('tools-container').innerHTML = `> ERROR: DATABASE_CONNECTION_FAILED`;
            }
        });

        function populateDropdowns() {
            const catSelect = document.getElementById('globalCategory');
            const categories = [...new Set(globalTools.map(t => t.category))].sort();
            categories.forEach(c => {
                const opt = document.createElement('option');
                opt.value = c;
                opt.textContent = `CAT: ${c.toUpperCase()}`;
                catSelect.appendChild(opt);
            });

            const stackSelect = document.getElementById('globalStack');
            globalStacks.forEach(s => {
                const opt = document.createElement('option');
                opt.value = s.id;
                opt.textContent = `STK: ${s.title.toUpperCase()}`;
                stackSelect.appendChild(opt);
            });
        }

        function renderAll() {
            renderTools();
            renderStacks();
        }

        function setStackFilter(stackId) {
            document.getElementById('globalStack').value = stackId;
            renderAll();
            document.getElementById('tools').scrollIntoView();
        }

        function generateToolCard(tool) {
            const stackChips = tool.usedIn.map(id => {
                const s = globalStacks.find(x => x.id === id);
                return s ? `<button onclick="setStackFilter('${id}')" class="bg-gray-900 border border-gray-700 text-[8px] text-gray-500 px-1 hover:text-cyan hover:border-cyan truncate max-w-full">${s.title}</button>` : '';
            }).join('');

            return `
            <div class="group border-2 border-gray-800 bg-black flex flex-col h-full hover:border-${tool.statusColor} transition-all duration-300">
                <!-- Header: Logo Area (Constrained) -->
                <div class="h-24 md:h-32 bg-gray-900/40 border-b border-gray-800 relative flex items-center justify-center p-6">
                    ${tool.logoUrl ? 
                        `<img src="${tool.logoUrl}" alt="${tool.name}" class="max-h-full max-w-full object-contain grayscale group-hover:grayscale-0 transition-all duration-500" onerror="this.outerHTML='<div class=\'w-12 h-12 text-gray-700 group-hover:text-${tool.statusColor}\'>${getCategoryIcon(tool.category)}</div>'">` : 
                        `<div class="w-12 h-12 text-gray-700 group-hover:text-${tool.statusColor} transition-colors">${getCategoryIcon(tool.category)}</div>`
                    }
                    <div class="absolute top-2 right-2">
                        <span class="bg-${tool.statusColor} text-${tool.statusColor === 'magenta' ? 'white' : 'black'} text-[8px] font-bold px-1.5 py-0.5 uppercase tracking-tighter">${tool.status}</span>
                    </div>
                </div>

                <!-- Info Body -->
                <div class="p-4 flex flex-col flex-grow">
                    <div class="mb-3">
                        <h3 class="font-loud text-xl uppercase truncate group-hover:text-${tool.statusColor} transition-colors leading-none mb-1">${tool.name}</h3>
                        <p class="text-[9px] text-gray-600 font-mono uppercase tracking-widest">${tool.category}</p>
                    </div>

                    <p class="text-[11px] text-gray-400 font-mono leading-tight line-clamp-2 mb-4 group-hover:text-gray-200 transition-colors">
                        ${tool.description}
                    </p>

                    <div class="flex flex-wrap gap-1 mb-4 mt-auto">
                        ${stackChips}
                    </div>

                    <!-- Actions -->
                    <div class="pt-4 border-t border-gray-900 space-y-1.5">
                        <a href="${tool.url}" target="_blank" class="block w-full text-center border border-gray-700 py-2 font-mono text-[10px] uppercase tracking-widest hover:bg-${tool.statusColor} hover:text-black hover:border-${tool.statusColor} transition-all">Open Tool -></a>
                        ${tool.docs ? `<a href="${tool.docs}" target="_blank" class="block w-full text-center border border-gray-800 py-1 font-mono text-[9px] uppercase tracking-widest text-gray-500 hover:text-white transition-all">Documentation</a>` : ''}
                        
                        <p class="text-[7px] text-gray-700 font-mono text-center uppercase tracking-tighter mt-2 leading-none">
                            Disclosure: Link may be affiliate.
                        </p>
                    </div>
                </div>
            </div>
            `;
        }

        function renderTools() {
            const search = document.getElementById('globalSearch').value.toLowerCase();
            const cat = document.getElementById('globalCategory').value;
            const stackFilter = document.getElementById('globalStack').value;
            const sort = document.getElementById('globalSort').value;

            let filtered = globalTools.filter(t => {
                const matchSearch = t.name.toLowerCase().includes(search) || t.description.toLowerCase().includes(search);
                const matchCat = cat === 'all' || t.category === cat;
                const matchStack = stackFilter === 'all' || t.usedIn.includes(stackFilter);
                return matchSearch && matchCat && matchStack;
            });

            // Sorting
            filtered.sort((a, b) => {
                if (sort === 'az') return a.name.localeCompare(b.name);
                if (sort === 'za') return b.name.localeCompare(a.name);
                if (sort === 'status') return a.status.localeCompare(b.status);
                return 0;
            });

            const container = document.getElementById('tools-container');
            if (filtered.length === 0) {
                container.innerHTML = `<div class="col-span-full py-16 border-2 border-dashed border-gray-800 text-gray-600 font-mono text-center uppercase tracking-widest">> ZERO_RESULTS_FOUND</div>`;
            } else {
                container.innerHTML = filtered.map(t => generateToolCard(t)).join('');
            }
        }

        function renderStacks() {
            const container = document.getElementById('challenge-stacks-container');
            container.innerHTML = globalStacks.map(stack => {
                const stackTools = stack.toolIds
                    .map(id => globalTools.find(t => t.id === id))
                    .filter(Boolean);

                return `
                <details class="group border border-gray-800 bg-black hover:border-cyan transition-all">
                    <summary class="cursor-pointer p-4 md:p-6 flex items-center justify-between outline-none">
                        <div>
                            <h3 class="font-mono text-cyan text-[10px] mb-1">ID: ${stack.id}</h3>
                            <p class="font-loud text-xl md:text-3xl text-white uppercase tracking-tighter">${stack.title}</p>
                        </div>
                        <span class="text-cyan font-mono group-open:rotate-90 transition-transform">></span>
                    </summary>
                    <div class="p-4 md:p-6 border-t border-gray-900 bg-gray-900/10">
                        <p class="font-mono text-gray-400 mb-6 italic border-l-2 border-cyan pl-4 text-sm">"${stack.hookLine}"</p>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                            <div>
                                <h4 class="text-[9px] text-gray-600 uppercase tracking-widest mb-2 font-bold">Process Logic:</h4>
                                <ul class="space-y-2 text-[11px] font-mono">
                                    ${stack.wireframe.process.map(p => `<li class="flex gap-2 text-gray-300"><span class="text-cyan">Â»</span> ${p}</li>`).join('')}
                                </ul>
                            </div>
                            <div>
                                <h4 class="text-[9px] text-gray-600 uppercase tracking-widest mb-2 font-bold">Projected Output:</h4>
                                <div class="bg-black border border-gray-800 p-3 text-[11px] font-mono text-acid mb-4">
                                    ${stack.wireframe.output.join(', ')}
                                </div>
                                <h4 class="text-[9px] text-gray-600 uppercase tracking-widest mb-2 font-bold">Validation Proof:</h4>
                                <div class="text-[11px] font-mono text-gray-500 italic">
                                    ${stack.wireframe.proof.join(' ')}
                                </div>
                            </div>
                        </div>

                        <div class="pt-4 border-t border-gray-900 flex flex-wrap gap-2">
                            ${stackTools.map(t => `<span class="bg-gray-900 text-gray-500 border border-gray-800 px-2 py-1 text-[9px] font-mono">${t.name}</span>`).join('')}
                        </div>
                    </div>
                </details>
                `;
            }).join('');
        }

        function toggleAllStacks() {
            const details = document.querySelectorAll('#challenge-stacks-container details');
            const btn = document.getElementById('toggleStacksBtn');
            const isExpanding = btn.dataset.state === 'collapsed';
            details.forEach(el => isExpanding ? el.setAttribute('open', '') : el.removeAttribute('open'));
            btn.dataset.state = isExpanding ? 'expanded' : 'collapsed';
            btn.innerHTML = isExpanding ? '> COLLAPSE ALL' : '> EXPAND ALL';
        }
    </script>
</body>
</html>